@model IEnumerable<Demosthenes.Core.Models.Post>

@{
    ViewBag.Title = "Posts";
}

@section scripts {
    @Scripts.Render("~/Scripts/app/elements/danger-dialog.js")
    @Scripts.Render("~/Scripts/app/elements/btn-submitter.js")
}

@Html.Partial("_DangerDialog")
@Html.Partial("_Title")

<div class="row">
    @foreach (Demosthenes.Core.Models.Post post in Model)
    {
        <div class="col-lg-12 col-md-12 col-sm-12">
            <h2>@Html.ActionLink(post.Title, "Details", "Posts", new { Id = post.Id }, null)</h2>
            <p>
                <a href="#"><span class="glyphicon glyphicon-user"></span></a>
                @post.Author.UserName,
                <small>@post.DateCreated</small>.
            </p>
            <p>@post.Body</p>

            @if (User.IsInRole("admin") || post.AuthorId == User.Identity.GetUserId())
            {
                using (Html.BeginForm("Delete", "Posts", FormMethod.Post, new { id = "delete" + post.Id + "Form" }))
                {
                    @Html.AntiForgeryToken()
                    @Html.Hidden("Id", post.Id)

                    if (post.AuthorId == User.Identity.GetUserId())
                    {
                        <a class="btn btn-sm btn-primary" href="/Posts/Edit/@post.Id"
                           title="Edit @post.Title"><span class="glyphicon glyphicon-edit"></span></a>
                    }

                    <a href="#"
                       title="Delete @post.Title" class="btn btn-sm btn-danger btn-submitter"><span class="glyphicon glyphicon-floppy-remove"></span></a>

                }
            }
        </div>
    }
</div>
